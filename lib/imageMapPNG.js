'use strict';

var sharp = require('sharp'),
    necessary = require('necessary');

var constants = require('./constants'),
    namesUtilities = require('./utilities/names');

var asynchronousUtilities = necessary.asynchronousUtilities,
    fileSystemUtilities = necessary.fileSystemUtilities,
    whilst = asynchronousUtilities.whilst,
    readDirectory = fileSystemUtilities.readDirectory,
    removeHiddenNames = namesUtilities.removeHiddenNames,
    dimensionFromNames = namesUtilities.dimensionFromNames,
    RED = constants.RED,
    BLUE = constants.BLUE,
    GREEN = constants.GREEN,
    ALPHA = constants.ALPHA,
    CHANNELS = constants.CHANNELS;


function imageMapPNG(names, imageDirectoryPath, overlayImageSize, response) {
  var namesLength = names.length;

  if (namesLength === 0) {
    names = readDirectory(imageDirectoryPath);
  }

  names = removeHiddenNames(names);

  var dimension = dimensionFromNames(names);

  createImageMap(dimension, overlayImageSize, function (imageBuffer) {
    var context = {
      names: names,
      dimension: dimension,
      imageBuffer: imageBuffer,
      overlayImageSize: overlayImageSize,
      imageDirectoryPath: imageDirectoryPath
    };

    whilst(compositeCallback, function () {
      response.writeHead(200, { 'Content-Type': 'image/png; charset=utf-8' });

      var imageBuffer = context.imageBuffer;


      sharp(imageBuffer).pipe(response);
    }, context);
  });
}

module.exports = imageMapPNG;

function createImageMap(dimension, overlayImageSize, callback) {
  var size = dimension * overlayImageSize,
      width = size,
      ///
  height = size,
      ///
  alpha = ALPHA,
      channels = CHANNELS,
      r = RED,
      ///
  g = GREEN,
      ///
  b = BLUE,
      ///
  background = {
    r: r,
    g: g,
    b: b,
    alpha: alpha
  },
      options = {
    width: width,
    height: height,
    channels: channels,
    background: background
  },
      create = options,
      ///
  imageMap = sharp({
    create: create
  });

  imageMap.png().toBuffer().then(function (imageBuffer) {
    callback(imageBuffer);
  });
}

function compositeCallback(next, done, context, index) {
  var names = context.names,
      dimension = context.dimension,
      imageBuffer = context.imageBuffer,
      overlayImageSize = context.overlayImageSize,
      imageDirectoryPath = context.imageDirectoryPath,
      namesLength = names.length,
      lastIndex = namesLength - 1;


  if (index > lastIndex) {
    done();

    return;
  }

  var name = names[index],
      path = imageDirectoryPath + '/' + name;

  resizeImage(path, overlayImageSize, function (resizedImageBuffer) {
    var top = (dimension - 1 - Math.floor(index / dimension)) * overlayImageSize,
        left = index % dimension * overlayImageSize,
        input = resizedImageBuffer,
        ///
    options = {
      top: top,
      left: left,
      input: input
    };

    sharp(imageBuffer).composite([options]) ///
    .toBuffer().then(function (imageBuffer) {
      Object.assign(context, {
        imageBuffer: imageBuffer
      });

      next();
    });
  });
}

function resizeImage(path, overlayImageSize, callback) {
  var width = overlayImageSize,
      ///
  height = overlayImageSize; ///

  sharp(path).resize(width, height).toBuffer().then(function (imageBuffer) {
    var resizedImageBuffer = imageBuffer; ///

    callback(resizedImageBuffer);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9pbWFnZU1hcFBORy5qcyJdLCJuYW1lcyI6WyJzaGFycCIsInJlcXVpcmUiLCJuZWNlc3NhcnkiLCJjb25zdGFudHMiLCJuYW1lc1V0aWxpdGllcyIsImFzeW5jaHJvbm91c1V0aWxpdGllcyIsImZpbGVTeXN0ZW1VdGlsaXRpZXMiLCJ3aGlsc3QiLCJyZWFkRGlyZWN0b3J5IiwicmVtb3ZlSGlkZGVuTmFtZXMiLCJkaW1lbnNpb25Gcm9tTmFtZXMiLCJSRUQiLCJCTFVFIiwiR1JFRU4iLCJBTFBIQSIsIkNIQU5ORUxTIiwiaW1hZ2VNYXBQTkciLCJuYW1lcyIsImltYWdlRGlyZWN0b3J5UGF0aCIsIm92ZXJsYXlJbWFnZVNpemUiLCJyZXNwb25zZSIsIm5hbWVzTGVuZ3RoIiwibGVuZ3RoIiwiZGltZW5zaW9uIiwiY3JlYXRlSW1hZ2VNYXAiLCJpbWFnZUJ1ZmZlciIsImNvbnRleHQiLCJjb21wb3NpdGVDYWxsYmFjayIsIndyaXRlSGVhZCIsInBpcGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiY2FsbGJhY2siLCJzaXplIiwid2lkdGgiLCJoZWlnaHQiLCJhbHBoYSIsImNoYW5uZWxzIiwiciIsImciLCJiIiwiYmFja2dyb3VuZCIsIm9wdGlvbnMiLCJjcmVhdGUiLCJpbWFnZU1hcCIsInBuZyIsInRvQnVmZmVyIiwidGhlbiIsIm5leHQiLCJkb25lIiwiaW5kZXgiLCJsYXN0SW5kZXgiLCJuYW1lIiwicGF0aCIsInJlc2l6ZUltYWdlIiwicmVzaXplZEltYWdlQnVmZmVyIiwidG9wIiwiTWF0aCIsImZsb29yIiwibGVmdCIsImlucHV0IiwiY29tcG9zaXRlIiwiT2JqZWN0IiwiYXNzaWduIiwicmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxRQUFRQyxRQUFRLE9BQVIsQ0FBZDtBQUFBLElBQ01DLFlBQVlELFFBQVEsV0FBUixDQURsQjs7QUFHQSxJQUFNRSxZQUFZRixRQUFRLGFBQVIsQ0FBbEI7QUFBQSxJQUNNRyxpQkFB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QixLQURWLEVBQ2lCQyxNQURqQixFQUVHVyxRQUZILEdBR0dDLElBSEgsQ0FHUSxVQUFTdEIsV0FBVCxFQUFzQjtBQUMxQixRQUFNOEIscUJBQXFCOUIsV0FBM0IsQ0FEMEIsQ0FDYzs7QUFFeENPLGFBQVN1QixrQkFBVDtBQUNELEdBUEg7QUFRRCIsImZpbGUiOiJpbWFnZU1hcFBORy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3Qgc2hhcnAgPSByZXF1aXJlKCdzaGFycCcpLFxuICAgICAgbmVjZXNzYXJ5ID0gcmVxdWlyZSgnbmVjZXNzYXJ5Jyk7XG5cbmNvbnN0IGNvbnN0YW50cyA9IHJlcXVpcmUoJy4vY29uc3RhbnRzJyksXG4gICAgICBuYW1lc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL25hbWVzJyk7XG5cbmNvbnN0IHsgYXN5bmNocm9ub3VzVXRpbGl0aWVzLCBmaWxlU3lzdGVtVXRpbGl0aWVzIH0gPSBuZWNlc3NhcnksXG4gICAgICB7IHdoaWxzdCB9ID0gYXN5bmNocm9ub3VzVXRpbGl0aWVzLFxuICAgICAgeyByZWFkRGlyZWN0b3J5IH0gPSBmaWxlU3lzdGVtVXRpbGl0aWVzLFxuICAgICAgeyByZW1vdmVIaWRkZW5OYW1lcywgZGltZW5zaW9uRnJvbU5hbWVzIH0gPSBuYW1lc1V0aWxpdGllcyxcbiAgICAgIHsgUkVELCBCTFVFLCBHUkVFTiwgQUxQSEEsIENIQU5ORUxTIH0gPSBjb25zdGFudHM7XG5cbmZ1bmN0aW9uIGltYWdlTWFwUE5HKG5hbWVzLCBpbWFnZURpcmVjdG9yeVBhdGgsIG92ZXJsYXlJbWFnZVNpemUsIHJlc3BvbnNlKSB7XG4gIGNvbnN0IG5hbWVzTGVuZ3RoID0gbmFtZXMubGVuZ3RoO1xuXG4gIGlmIChuYW1lc0xlbmd0aCA9PT0gMCkge1xuICAgIG5hbWVzID0gcmVhZERpcmVjdG9yeShpbWFnZURpcmVjdG9yeVBhdGgpO1xuICB9XG5cbiAgbmFtZXMgPSByZW1vdmVIaWRkZW5OYW1lcyhuYW1lcyk7XG5cbiAgY29uc3QgZGltZW5zaW9uID0gZGltZW5zaW9uRnJvbU5hbWVzKG5hbWVzKTtcblxuICBjcmVhdGVJbWFnZU1hcChkaW1lbnNpb24sIG92ZXJsYXlJbWFnZVNpemUsIGZ1bmN0aW9uKGltYWdlQnVmZmVyKSB7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgIG5hbWVzLFxuICAgICAgZGltZW5zaW9uLFxuICAgICAgaW1hZ2VCdWZmZXIsXG4gICAgICBvdmVybGF5SW1hZ2VTaXplLFxuICAgICAgaW1hZ2VEaXJlY3RvcnlQYXRoXG4gICAgfTtcblxuICAgIHdoaWxzdChjb21wb3NpdGVDYWxsYmFjaywgZnVuY3Rpb24oKSB7XG4gICAgICByZXNwb25zZS53cml0ZUhlYWQoMjAwLCB7J0NvbnRlbnQtVHlwZSc6ICdpbWFnZS9wbmc7IGNoYXJzZXQ9dXRmLTgnfSk7XG5cbiAgICAgIGNvbnN0IHsgaW1hZ2VCdWZmZXIgfSA9IGNvbnRleHQ7XG5cbiAgICAgIHNoYXJwKGltYWdlQnVmZmVyKS5waXBlKHJlc3BvbnNlKTtcbiAgICB9LCBjb250ZXh0KTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gaW1hZ2VNYXBQTkc7XG5cbmZ1bmN0aW9uIGNyZWF0ZUltYWdlTWFwKGRpbWVuc2lvbiwgb3ZlcmxheUltYWdlU2l6ZSwgY2FsbGJhY2spIHtcbiAgY29uc3Qgc2l6ZSA9IGRpbWVuc2lvbiAqIG92ZXJsYXlJbWFnZVNpemUsXG4gICAgICAgIHdpZHRoID0gc2l6ZSxcdC8vL1xuICAgICAgICBoZWlnaHQgPSBzaXplLFx0Ly8vXG4gICAgICAgIGFscGhhID0gQUxQSEEsXG4gICAgICAgIGNoYW5uZWxzID0gQ0hBTk5FTFMsXG4gICAgICAgIHIgPSBSRUQsXHQvLy9cbiAgICAgICAgZyA9IEdSRUVOLFx0Ly8vXG4gICAgICAgIGIgPSBCTFVFLFx0Ly8vXG4gICAgICAgIGJhY2tncm91bmQgPSB7XG4gICAgICAgICAgcixcbiAgICAgICAgICBnLFxuICAgICAgICAgIGIsXG4gICAgICAgICAgYWxwaGFcbiAgICAgICAgfSxcbiAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICBoZWlnaHQsXG4gICAgICAgICAgY2hhbm5lbHMsXG4gICAgICAgICAgYmFja2dyb3VuZFxuICAgICAgICB9LFxuICAgICAgICBjcmVhdGUgPSBvcHRpb25zLCAvLy9cbiAgICAgICAgaW1hZ2VNYXAgPSBzaGFycCh7XG4gICAgICAgICAgY3JlYXRlXG4gICAgICAgIH0pO1xuXG4gIGltYWdlTWFwXG4gICAgLnBuZygpXG4gICAgLnRvQnVmZmVyKClcbiAgICAudGhlbihmdW5jdGlvbihpbWFnZUJ1ZmZlcikge1xuICAgICAgY2FsbGJhY2soaW1hZ2VCdWZmZXIpXG4gICAgfSk7XG4gIH1cblxuZnVuY3Rpb24gY29tcG9zaXRlQ2FsbGJhY2sobmV4dCwgZG9uZSwgY29udGV4dCwgaW5kZXgpIHtcbiAgY29uc3QgeyBuYW1lcywgZGltZW5zaW9uLCBpbWFnZUJ1ZmZlciwgb3ZlcmxheUltYWdlU2l6ZSwgaW1hZ2VEaXJlY3RvcnlQYXRoIH0gPSBjb250ZXh0LFxuICAgICAgICBuYW1lc0xlbmd0aCA9IG5hbWVzLmxlbmd0aCxcbiAgICAgICAgbGFzdEluZGV4ID0gbmFtZXNMZW5ndGggLSAxO1xuXG4gIGlmIChpbmRleCA+IGxhc3RJbmRleCkge1xuICAgIGRvbmUoKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG5hbWUgPSBuYW1lc1tpbmRleF0sXG4gICAgICAgIHBhdGggPSBgJHtpbWFnZURpcmVjdG9yeVBhdGh9LyR7bmFtZX1gO1xuXG4gIHJlc2l6ZUltYWdlKHBhdGgsIG92ZXJsYXlJbWFnZVNpemUsIGZ1bmN0aW9uKHJlc2l6ZWRJbWFnZUJ1ZmZlcikge1xuICAgIGNvbnN0IHRvcCA9ICgoZGltZW5zaW9uIC0gMSkgLSBNYXRoLmZsb29yKGluZGV4IC8gZGltZW5zaW9uKSkgKiBvdmVybGF5SW1hZ2VTaXplLFxuICAgICAgICAgIGxlZnQgPSAoaW5kZXggJSBkaW1lbnNpb24pICogb3ZlcmxheUltYWdlU2l6ZSxcbiAgICAgICAgICBpbnB1dCA9IHJlc2l6ZWRJbWFnZUJ1ZmZlciwgLy8vXG4gICAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRvcCxcbiAgICAgICAgICAgIGxlZnQsXG4gICAgICAgICAgICBpbnB1dFxuICAgICAgICAgIH07XG5cbiAgICBzaGFycChpbWFnZUJ1ZmZlcilcbiAgICAgIC5jb21wb3NpdGUoW29wdGlvbnNdKSAvLy9cbiAgICAgIC50b0J1ZmZlcigpXG4gICAgICAudGhlbihmdW5jdGlvbihpbWFnZUJ1ZmZlcikge1xuICAgICAgICBPYmplY3QuYXNzaWduKGNvbnRleHQsIHtcbiAgICAgICAgICBpbWFnZUJ1ZmZlclxuICAgICAgICB9KTtcblxuICAgICAgICBuZXh0KCk7XG4gICAgICB9KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gcmVzaXplSW1hZ2UocGF0aCwgb3ZlcmxheUltYWdlU2l6ZSwgY2FsbGJhY2spIHtcbiAgY29uc3Qgd2lkdGggPSBvdmVybGF5SW1hZ2VTaXplLCAvLy9cbiAgICAgICAgaGVpZ2h0ID0gb3ZlcmxheUltYWdlU2l6ZTsgIC8vL1xuXG4gIHNoYXJwKHBhdGgpXG4gICAgLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KVxuICAgIC50b0J1ZmZlcigpXG4gICAgLnRoZW4oZnVuY3Rpb24oaW1hZ2VCdWZmZXIpIHtcbiAgICAgIGNvbnN0IHJlc2l6ZWRJbWFnZUJ1ZmZlciA9IGltYWdlQnVmZmVyOyAvLy9cblxuICAgICAgY2FsbGJhY2socmVzaXplZEltYWdlQnVmZmVyKTtcbiAgICB9KTtcbn1cbiJdfQ==